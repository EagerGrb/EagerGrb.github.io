"use strict";(self.webpackChunkrobin_note_book=self.webpackChunkrobin_note_book||[]).push([[9084],{120:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"L-\u6e90\u7801\u7cfb\u5217/es5-vs-es6-runtime","title":"ES5\u4e0eES6\u5728JavaScript\u8fd0\u884c\u65f6\u7684\u5dee\u5f02\u5206\u6790","description":"\u6982\u8ff0","source":"@site/docs/L-\u6e90\u7801\u7cfb\u5217/11-es5-vs-es6-runtime.md","sourceDirName":"L-\u6e90\u7801\u7cfb\u5217","slug":"/L-\u6e90\u7801\u7cfb\u5217/es5-vs-es6-runtime","permalink":"/docs/en/main/L-\u6e90\u7801\u7cfb\u5217/es5-vs-es6-runtime","draft":false,"unlisted":false,"editUrl":"https://github.com/EagerGrb/docs/L-\u6e90\u7801\u7cfb\u5217/11-es5-vs-es6-runtime.md","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u53d8\u91cf\u63d0\u5347\u673a\u5236\u6df1\u5ea6\u5206\u6790","permalink":"/docs/en/main/L-\u6e90\u7801\u7cfb\u5217/variable-hoisting"},"next":{"title":"Map\u3001Set\u3001Object\u5e95\u5c42\u5b9e\u73b0\u4e0e\u6027\u80fd\u5206\u6790","permalink":"/docs/en/main/L-\u6e90\u7801\u7cfb\u5217/map-set-object-implementation"}}');var i=r(4848),a=r(8453);const l={},t="ES5\u4e0eES6\u5728JavaScript\u8fd0\u884c\u65f6\u7684\u5dee\u5f02\u5206\u6790",c={},o=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"1. \u4f5c\u7528\u57df\u548c\u53d8\u91cf\u58f0\u660e",id:"1-\u4f5c\u7528\u57df\u548c\u53d8\u91cf\u58f0\u660e",level:2},{value:"ES5: \u51fd\u6570\u4f5c\u7528\u57df + var",id:"es5-\u51fd\u6570\u4f5c\u7528\u57df--var",level:3},{value:"var\u7684\u5b9e\u73b0",id:"var\u7684\u5b9e\u73b0",level:4},{value:"ES6: \u5757\u7ea7\u4f5c\u7528\u57df + let/const",id:"es6-\u5757\u7ea7\u4f5c\u7528\u57df--letconst",level:3},{value:"\u5757\u7ea7\u4f5c\u7528\u57df\u521b\u5efa",id:"\u5757\u7ea7\u4f5c\u7528\u57df\u521b\u5efa",level:4},{value:"\u6682\u65f6\u6027\u6b7b\u533a(TDZ)\u5b9e\u73b0",id:"\u6682\u65f6\u6027\u6b7b\u533atdz\u5b9e\u73b0",level:4},{value:"\u8fd0\u884c\u65f6TDZ\u68c0\u67e5",id:"\u8fd0\u884c\u65f6tdz\u68c0\u67e5",level:4},{value:"2. \u7bad\u5934\u51fd\u6570 vs \u666e\u901a\u51fd\u6570",id:"2-\u7bad\u5934\u51fd\u6570-vs-\u666e\u901a\u51fd\u6570",level:2},{value:"this\u7ed1\u5b9a\u5dee\u5f02",id:"this\u7ed1\u5b9a\u5dee\u5f02",level:3},{value:"ES5\u666e\u901a\u51fd\u6570",id:"es5\u666e\u901a\u51fd\u6570",level:4},{value:"ES6\u7bad\u5934\u51fd\u6570",id:"es6\u7bad\u5934\u51fd\u6570",level:4},{value:"arguments\u5bf9\u8c61\u5dee\u5f02",id:"arguments\u5bf9\u8c61\u5dee\u5f02",level:3},{value:"ES5\u51fd\u6570\u6709arguments",id:"es5\u51fd\u6570\u6709arguments",level:4},{value:"ES6\u7bad\u5934\u51fd\u6570\u65e0arguments",id:"es6\u7bad\u5934\u51fd\u6570\u65e0arguments",level:4},{value:"3. \u7c7b(Class)\u7684\u5b9e\u73b0",id:"3-\u7c7bclass\u7684\u5b9e\u73b0",level:2},{value:"ES5: \u6784\u9020\u51fd\u6570 + \u539f\u578b",id:"es5-\u6784\u9020\u51fd\u6570--\u539f\u578b",level:3},{value:"ES6: \u539f\u751f\u7c7b\u652f\u6301",id:"es6-\u539f\u751f\u7c7b\u652f\u6301",level:3},{value:"\u7c7b\u7684AST\u8868\u793a",id:"\u7c7b\u7684ast\u8868\u793a",level:4},{value:"\u7c7b\u7684\u5b57\u8282\u7801\u751f\u6210",id:"\u7c7b\u7684\u5b57\u8282\u7801\u751f\u6210",level:4},{value:"super\u5173\u952e\u5b57\u5b9e\u73b0",id:"super\u5173\u952e\u5b57\u5b9e\u73b0",level:4},{value:"4. \u6a21\u5757\u7cfb\u7edf",id:"4-\u6a21\u5757\u7cfb\u7edf",level:2},{value:"ES5: \u65e0\u539f\u751f\u6a21\u5757\u652f\u6301",id:"es5-\u65e0\u539f\u751f\u6a21\u5757\u652f\u6301",level:3},{value:"ES6: \u539f\u751f\u6a21\u5757\u652f\u6301",id:"es6-\u539f\u751f\u6a21\u5757\u652f\u6301",level:3},{value:"\u6a21\u5757\u4f5c\u7528\u57df",id:"\u6a21\u5757\u4f5c\u7528\u57df",level:4},{value:"import/export\u5904\u7406",id:"importexport\u5904\u7406",level:4},{value:"5. \u5f02\u6b65\u7f16\u7a0b",id:"5-\u5f02\u6b65\u7f16\u7a0b",level:2},{value:"ES5: \u56de\u8c03\u51fd\u6570",id:"es5-\u56de\u8c03\u51fd\u6570",level:3},{value:"ES6: Promise + async/await",id:"es6-promise--asyncawait",level:3},{value:"Promise\u7684\u5185\u7f6e\u5b9e\u73b0",id:"promise\u7684\u5185\u7f6e\u5b9e\u73b0",level:4},{value:"async/await\u7684\u8f6c\u6362",id:"asyncawait\u7684\u8f6c\u6362",level:4},{value:"6. \u89e3\u6784\u8d4b\u503c",id:"6-\u89e3\u6784\u8d4b\u503c",level:2},{value:"ES5: \u624b\u52a8\u63d0\u53d6",id:"es5-\u624b\u52a8\u63d0\u53d6",level:3},{value:"ES6: \u89e3\u6784\u8bed\u6cd5",id:"es6-\u89e3\u6784\u8bed\u6cd5",level:3},{value:"\u89e3\u6784\u7684AST\u8868\u793a",id:"\u89e3\u6784\u7684ast\u8868\u793a",level:4},{value:"\u89e3\u6784\u7684\u5b57\u8282\u7801\u751f\u6210",id:"\u89e3\u6784\u7684\u5b57\u8282\u7801\u751f\u6210",level:4},{value:"7. \u6a21\u677f\u5b57\u7b26\u4e32",id:"7-\u6a21\u677f\u5b57\u7b26\u4e32",level:2},{value:"ES5: \u5b57\u7b26\u4e32\u62fc\u63a5",id:"es5-\u5b57\u7b26\u4e32\u62fc\u63a5",level:3},{value:"ES6: \u6a21\u677f\u5b57\u7b26\u4e32",id:"es6-\u6a21\u677f\u5b57\u7b26\u4e32",level:3},{value:"\u6a21\u677f\u5b57\u7b26\u4e32\u7684AST",id:"\u6a21\u677f\u5b57\u7b26\u4e32\u7684ast",level:4},{value:"\u6807\u7b7e\u6a21\u677f\u51fd\u6570",id:"\u6807\u7b7e\u6a21\u677f\u51fd\u6570",level:4},{value:"8. \u6027\u80fd\u5dee\u5f02",id:"8-\u6027\u80fd\u5dee\u5f02",level:2},{value:"\u7f16\u8bd1\u65f6\u4f18\u5316",id:"\u7f16\u8bd1\u65f6\u4f18\u5316",level:3},{value:"ES6\u7279\u6027\u7684\u4f18\u5316",id:"es6\u7279\u6027\u7684\u4f18\u5316",level:4},{value:"\u8fd0\u884c\u65f6\u6027\u80fd",id:"\u8fd0\u884c\u65f6\u6027\u80fd",level:3},{value:"let/const\u7684\u6027\u80fd\u5f00\u9500",id:"letconst\u7684\u6027\u80fd\u5f00\u9500",level:4},{value:"\u5757\u7ea7\u4f5c\u7528\u57df\u7684\u5185\u5b58\u5f00\u9500",id:"\u5757\u7ea7\u4f5c\u7528\u57df\u7684\u5185\u5b58\u5f00\u9500",level:4},{value:"9. \u8c03\u8bd5\u548c\u5de5\u5177\u652f\u6301",id:"9-\u8c03\u8bd5\u548c\u5de5\u5177\u652f\u6301",level:2},{value:"\u6e90\u7801\u6620\u5c04",id:"\u6e90\u7801\u6620\u5c04",level:3},{value:"\u8c03\u8bd5\u4fe1\u606f",id:"\u8c03\u8bd5\u4fe1\u606f",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"es5\u4e0ees6\u5728javascript\u8fd0\u884c\u65f6\u7684\u5dee\u5f02\u5206\u6790",children:"ES5\u4e0eES6\u5728JavaScript\u8fd0\u884c\u65f6\u7684\u5dee\u5f02\u5206\u6790"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsx)(n.p,{children:"ES6\uff08ES2015\uff09\u5f15\u5165\u4e86\u8bb8\u591a\u65b0\u7279\u6027\uff0c\u8fd9\u4e9b\u7279\u6027\u5728V8\u5f15\u64ce\u4e2d\u9700\u8981\u4e0d\u540c\u7684\u8fd0\u884c\u65f6\u652f\u6301\u548c\u5b9e\u73b0\u673a\u5236\u3002\u672c\u6587\u6863\u6df1\u5165\u5206\u6790\u8fd9\u4e9b\u5dee\u5f02\u7684\u5e95\u5c42\u5b9e\u73b0\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"1-\u4f5c\u7528\u57df\u548c\u53d8\u91cf\u58f0\u660e",children:"1. \u4f5c\u7528\u57df\u548c\u53d8\u91cf\u58f0\u660e"}),"\n",(0,i.jsx)(n.h3,{id:"es5-\u51fd\u6570\u4f5c\u7528\u57df--var",children:"ES5: \u51fd\u6570\u4f5c\u7528\u57df + var"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// src/parsing/parser.cc\nenum VariableMode {\n  kVar,        // ES5 var\u58f0\u660e\n  kLet,        // ES6 let\u58f0\u660e  \n  kConst,      // ES6 const\u58f0\u660e\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"var\u7684\u5b9e\u73b0",children:"var\u7684\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// ES5\u4ee3\u7801\nfunction es5Example() {\n  if (true) {\n    var x = 1;\n  }\n  console.log(x); // 1 - var\u63d0\u5347\u5230\u51fd\u6570\u4f5c\u7528\u57df\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"V8\u5904\u7406\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// var\u58f0\u660e\u603b\u662f\u63d0\u5347\u5230\u51fd\u6570\u4f5c\u7528\u57df\nVariable* Parser::DeclareVariable(const AstRawString* name, \n                                 VariableMode mode) {\n  if (mode == VariableMode::kVar) {\n    // \u63d0\u5347\u5230\u6700\u8fd1\u7684\u51fd\u6570\u4f5c\u7528\u57df\u6216\u5168\u5c40\u4f5c\u7528\u57df\n    DeclarationScope* scope = GetDeclarationScope();\n    return scope->DeclareVariable(name, mode, kCreatedInitialized);\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"es6-\u5757\u7ea7\u4f5c\u7528\u57df--letconst",children:"ES6: \u5757\u7ea7\u4f5c\u7528\u57df + let/const"}),"\n",(0,i.jsx)(n.h4,{id:"\u5757\u7ea7\u4f5c\u7528\u57df\u521b\u5efa",children:"\u5757\u7ea7\u4f5c\u7528\u57df\u521b\u5efa"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u6bcf\u4e2a\u5757\u90fd\u521b\u5efa\u65b0\u7684\u4f5c\u7528\u57df\nStatement* Parser::ParseBlock() {\n  Scope* block_scope = NewScope(BLOCK_SCOPE);\n  BlockState block_state(&scope_, block_scope);\n  // \u89e3\u6790\u5757\u5185\u5bb9\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u6682\u65f6\u6027\u6b7b\u533atdz\u5b9e\u73b0",children:"\u6682\u65f6\u6027\u6b7b\u533a(TDZ)\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class Variable {\n  // TDZ\u72b6\u6001\u8ddf\u8e2a\n  enum InitializationFlag {\n    kNeedsInitialization,  // let/const\u9700\u8981\u521d\u59cb\u5316\u68c0\u67e5\n    kCreatedInitialized    // var\u5df2\u521d\u59cb\u5316\n  };\n  \n  int initializer_position_; // \u521d\u59cb\u5316\u4f4d\u7f6e\uff0c\u7528\u4e8eTDZ\u68c0\u67e5\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u8fd0\u884c\u65f6tdz\u68c0\u67e5",children:"\u8fd0\u884c\u65f6TDZ\u68c0\u67e5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u5b57\u8282\u7801\u751f\u6210\u65f6\u63d2\u5165TDZ\u68c0\u67e5\nvoid BytecodeGenerator::VisitVariableProxy(VariableProxy* proxy) {\n  Variable* var = proxy->var();\n  if (var->IsLexical() && var->binding_needs_init()) {\n    // \u751f\u6210TDZ\u68c0\u67e5\u5b57\u8282\u7801\n    builder()->ThrowReferenceErrorIfHole(var->raw_name());\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"2-\u7bad\u5934\u51fd\u6570-vs-\u666e\u901a\u51fd\u6570",children:"2. \u7bad\u5934\u51fd\u6570 vs \u666e\u901a\u51fd\u6570"}),"\n",(0,i.jsx)(n.h3,{id:"this\u7ed1\u5b9a\u5dee\u5f02",children:"this\u7ed1\u5b9a\u5dee\u5f02"}),"\n",(0,i.jsx)(n.h4,{id:"es5\u666e\u901a\u51fd\u6570",children:"ES5\u666e\u901a\u51fd\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u666e\u901a\u51fd\u6570\u6709\u81ea\u5df1\u7684this\u7ed1\u5b9a\nclass FunctionLiteral : public Expression {\n  FunctionKind kind_;  // kNormalFunction\n  \n  // \u666e\u901a\u51fd\u6570\u9700\u8981this\u7ed1\u5b9a\n  bool needs_this_binding() const {\n    return !IsArrowFunction(kind_);\n  }\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"es6\u7bad\u5934\u51fd\u6570",children:"ES6\u7bad\u5934\u51fd\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u7bad\u5934\u51fd\u6570\u7ee7\u627f\u5916\u5c42this\nbool IsArrowFunction(FunctionKind kind) {\n  return kind == FunctionKind::kArrowFunction ||\n         kind == FunctionKind::kAsyncArrowFunction;\n}\n\n// \u7bad\u5934\u51fd\u6570\u5b57\u8282\u7801\u751f\u6210\nvoid BytecodeGenerator::VisitFunctionLiteral(FunctionLiteral* expr) {\n  if (IsArrowFunction(expr->kind())) {\n    // \u7bad\u5934\u51fd\u6570\u4e0d\u521b\u5efa\u65b0\u7684this\u7ed1\u5b9a\n    // \u76f4\u63a5\u4f7f\u7528\u5916\u5c42\u4f5c\u7528\u57df\u7684this\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"arguments\u5bf9\u8c61\u5dee\u5f02",children:"arguments\u5bf9\u8c61\u5dee\u5f02"}),"\n",(0,i.jsx)(n.h4,{id:"es5\u51fd\u6570\u6709arguments",children:"ES5\u51fd\u6570\u6709arguments"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u666e\u901a\u51fd\u6570\u521b\u5efaarguments\u5bf9\u8c61\nvoid DeclarationScope::DeclareArguments(AstValueFactory* ast_value_factory) {\n  if (!IsArrowFunction(function_kind_)) {\n    // \u521b\u5efaarguments\u53d8\u91cf\n    arguments_ = DeclareLocal(ast_value_factory->arguments_string(),\n                             VariableMode::kVar, ARGUMENTS_VARIABLE);\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"es6\u7bad\u5934\u51fd\u6570\u65e0arguments",children:"ES6\u7bad\u5934\u51fd\u6570\u65e0arguments"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// ES5\nfunction es5Func() {\n  console.log(arguments); // [Arguments] { '0': 1, '1': 2 }\n}\n\n// ES6\nconst es6Func = () => {\n  console.log(arguments); // ReferenceError: arguments is not defined\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"3-\u7c7bclass\u7684\u5b9e\u73b0",children:"3. \u7c7b(Class)\u7684\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.h3,{id:"es5-\u6784\u9020\u51fd\u6570--\u539f\u578b",children:"ES5: \u6784\u9020\u51fd\u6570 + \u539f\u578b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// ES5\u7c7b\u6a21\u62df\nfunction Person(name) {\n  this.name = name;\n}\nPerson.prototype.sayHello = function() {\n  return "Hello, " + this.name;\n};\n'})}),"\n",(0,i.jsx)(n.h3,{id:"es6-\u539f\u751f\u7c7b\u652f\u6301",children:"ES6: \u539f\u751f\u7c7b\u652f\u6301"}),"\n",(0,i.jsx)(n.h4,{id:"\u7c7b\u7684ast\u8868\u793a",children:"\u7c7b\u7684AST\u8868\u793a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class ClassLiteral : public Expression {\n  FunctionLiteral* constructor_;           // \u6784\u9020\u51fd\u6570\n  ZonePtrList<ClassLiteralProperty>* public_members_;   // \u516c\u5171\u6210\u5458\n  ZonePtrList<ClassLiteralProperty>* private_members_;  // \u79c1\u6709\u6210\u5458\n  Expression* extends_;                    // \u7ee7\u627f\u7684\u7236\u7c7b\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u7c7b\u7684\u5b57\u8282\u7801\u751f\u6210",children:"\u7c7b\u7684\u5b57\u8282\u7801\u751f\u6210"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"void BytecodeGenerator::VisitClassLiteral(ClassLiteral* expr) {\n  // 1. \u521b\u5efa\u6784\u9020\u51fd\u6570\n  VisitFunctionLiteral(expr->constructor());\n  \n  // 2. \u8bbe\u7f6e\u539f\u578b\u94fe\n  if (expr->extends()) {\n    // \u5904\u7406\u7ee7\u627f\n    builder()->SetPrototype();\n  }\n  \n  // 3. \u5b9a\u4e49\u65b9\u6cd5\n  for (auto* property : *expr->public_members()) {\n    DefineClassMethod(property);\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"super\u5173\u952e\u5b57\u5b9e\u73b0",children:"super\u5173\u952e\u5b57\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// super\u8c03\u7528\u7684\u7279\u6b8a\u5904\u7406\nclass SuperCallReference : public Expression {\n  VariableProxy* new_target_var_;    // new.target\u5f15\u7528\n  VariableProxy* this_function_var_; // \u5f53\u524d\u51fd\u6570\u5f15\u7528\n};\n\n// super\u5c5e\u6027\u8bbf\u95ee\nclass SuperPropertyReference : public Expression {\n  VariableProxy* home_object_;  // \u65b9\u6cd5\u6240\u5c5e\u5bf9\u8c61\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"4-\u6a21\u5757\u7cfb\u7edf",children:"4. \u6a21\u5757\u7cfb\u7edf"}),"\n",(0,i.jsx)(n.h3,{id:"es5-\u65e0\u539f\u751f\u6a21\u5757\u652f\u6301",children:"ES5: \u65e0\u539f\u751f\u6a21\u5757\u652f\u6301"}),"\n",(0,i.jsx)(n.p,{children:"ES5\u4f9d\u8d56\u5916\u90e8\u6a21\u5757\u7cfb\u7edf\uff08\u5982CommonJS\u3001AMD\uff09"}),"\n",(0,i.jsx)(n.h3,{id:"es6-\u539f\u751f\u6a21\u5757\u652f\u6301",children:"ES6: \u539f\u751f\u6a21\u5757\u652f\u6301"}),"\n",(0,i.jsx)(n.h4,{id:"\u6a21\u5757\u4f5c\u7528\u57df",children:"\u6a21\u5757\u4f5c\u7528\u57df"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class ModuleScope : public DeclarationScope {\n  SourceTextModuleDescriptor* module_descriptor_;\n  \n  // \u6a21\u5757\u5bfc\u5165\u5bfc\u51fa\u7ba1\u7406\n  void AddImport(const AstRawString* import_name,\n                const AstRawString* local_name,\n                const AstRawString* module_specifier);\n                \n  void AddExport(const AstRawString* local_name,\n                const AstRawString* export_name);\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"importexport\u5904\u7406",children:"import/export\u5904\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// import\u8bed\u53e5\u89e3\u6790\nvoid Parser::ParseImportDeclaration() {\n  // \u89e3\u6790import\u8bed\u6cd5\n  const AstRawString* module_specifier = ParseModuleSpecifier();\n  \n  // \u6dfb\u52a0\u5230\u6a21\u5757\u63cf\u8ff0\u7b26\n  module()->AddImport(import_name, local_name, module_specifier);\n}\n\n// export\u8bed\u53e5\u89e3\u6790  \nStatement* Parser::ParseExportDeclaration() {\n  // \u89e3\u6790export\u8bed\u6cd5\n  module()->AddExport(local_name, export_name);\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"5-\u5f02\u6b65\u7f16\u7a0b",children:"5. \u5f02\u6b65\u7f16\u7a0b"}),"\n",(0,i.jsx)(n.h3,{id:"es5-\u56de\u8c03\u51fd\u6570",children:"ES5: \u56de\u8c03\u51fd\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// ES5\u5f02\u6b65\u6a21\u5f0f\nfunction fetchData(callback) {\n  setTimeout(function() {\n    callback(null, "data");\n  }, 1000);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"es6-promise--asyncawait",children:"ES6: Promise + async/await"}),"\n",(0,i.jsx)(n.h4,{id:"promise\u7684\u5185\u7f6e\u5b9e\u73b0",children:"Promise\u7684\u5185\u7f6e\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// src/builtins/builtins-promise.cc\nBUILTIN(PromiseConstructor) {\n  // Promise\u6784\u9020\u51fd\u6570\u5b9e\u73b0\n  Handle<JSPromise> promise = Handle<JSPromise>::cast(\n      JSObject::New(target, new_target));\n  \n  // \u6267\u884cexecutor\u51fd\u6570\n  return ExecutePromiseExecutor(isolate, promise, executor);\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"asyncawait\u7684\u8f6c\u6362",children:"async/await\u7684\u8f6c\u6362"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// async\u51fd\u6570\u88ab\u8f6c\u6362\u4e3a\u751f\u6210\u5668\u51fd\u6570\nFunctionKind GetAsyncFunctionKind(FunctionKind kind) {\n  switch (kind) {\n    case FunctionKind::kNormalFunction:\n      return FunctionKind::kAsyncFunction;\n    case FunctionKind::kArrowFunction:\n      return FunctionKind::kAsyncArrowFunction;\n  }\n}\n\n// await\u8868\u8fbe\u5f0f\u5904\u7406\nExpression* Parser::ParseAwaitExpression() {\n  // await\u88ab\u8f6c\u6362\u4e3ayield\u8868\u8fbe\u5f0f\n  Expression* value = ParseUnaryExpression();\n  return factory()->NewAwait(value, pos);\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"6-\u89e3\u6784\u8d4b\u503c",children:"6. \u89e3\u6784\u8d4b\u503c"}),"\n",(0,i.jsx)(n.h3,{id:"es5-\u624b\u52a8\u63d0\u53d6",children:"ES5: \u624b\u52a8\u63d0\u53d6"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// ES5\nvar arr = [1, 2, 3];\nvar a = arr[0];\nvar b = arr[1];\n"})}),"\n",(0,i.jsx)(n.h3,{id:"es6-\u89e3\u6784\u8bed\u6cd5",children:"ES6: \u89e3\u6784\u8bed\u6cd5"}),"\n",(0,i.jsx)(n.h4,{id:"\u89e3\u6784\u7684ast\u8868\u793a",children:"\u89e3\u6784\u7684AST\u8868\u793a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class ArrayPattern : public Pattern {\n  ZonePtrList<Expression>* values_;  // \u89e3\u6784\u76ee\u6807\n};\n\nclass ObjectPattern : public Pattern {\n  ZonePtrList<ObjectPatternProperty>* properties_;\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u89e3\u6784\u7684\u5b57\u8282\u7801\u751f\u6210",children:"\u89e3\u6784\u7684\u5b57\u8282\u7801\u751f\u6210"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"void BytecodeGenerator::VisitArrayPattern(ArrayPattern* pattern) {\n  // \u6570\u7ec4\u89e3\u6784\n  for (int i = 0; i < pattern->values()->length(); i++) {\n    // \u751f\u6210 obj[i] \u8bbf\u95ee\n    builder()->LoadKeyedProperty(object, i);\n    // \u8d4b\u503c\u7ed9\u76ee\u6807\u53d8\u91cf\n    VisitForEffect(pattern->values()->at(i));\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"7-\u6a21\u677f\u5b57\u7b26\u4e32",children:"7. \u6a21\u677f\u5b57\u7b26\u4e32"}),"\n",(0,i.jsx)(n.h3,{id:"es5-\u5b57\u7b26\u4e32\u62fc\u63a5",children:"ES5: \u5b57\u7b26\u4e32\u62fc\u63a5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// ES5\nvar name = "World";\nvar message = "Hello, " + name + "!";\n'})}),"\n",(0,i.jsx)(n.h3,{id:"es6-\u6a21\u677f\u5b57\u7b26\u4e32",children:"ES6: \u6a21\u677f\u5b57\u7b26\u4e32"}),"\n",(0,i.jsx)(n.h4,{id:"\u6a21\u677f\u5b57\u7b26\u4e32\u7684ast",children:"\u6a21\u677f\u5b57\u7b26\u4e32\u7684AST"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class TemplateLiteral : public Expression {\n  ZonePtrList<const AstRawString>* cooked_strings_;  // \u5904\u7406\u540e\u7684\u5b57\u7b26\u4e32\n  ZonePtrList<const AstRawString>* raw_strings_;     // \u539f\u59cb\u5b57\u7b26\u4e32\n  ZonePtrList<Expression>* expressions_;             // \u63d2\u503c\u8868\u8fbe\u5f0f\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u6807\u7b7e\u6a21\u677f\u51fd\u6570",children:"\u6807\u7b7e\u6a21\u677f\u51fd\u6570"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class TaggedTemplate : public Expression {\n  Expression* tag_;                    // \u6807\u7b7e\u51fd\u6570\n  ZonePtrList<Expression>* arguments_; // \u53c2\u6570\u5217\u8868\n};\n\n// \u751f\u6210GetTemplateObject\u8c03\u7528\nExpression* Parser::CloseTemplateLiteral(TemplateLiteralState* state,\n                                        Expression* tag) {\n  if (tag) {\n    // \u6807\u7b7e\u6a21\u677f\uff1atag`template`\n    Expression* template_object = \n        factory()->NewGetTemplateObject(cooked_strings, raw_strings, pos);\n    return factory()->NewTaggedTemplate(tag, call_args, pos);\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"8-\u6027\u80fd\u5dee\u5f02",children:"8. \u6027\u80fd\u5dee\u5f02"}),"\n",(0,i.jsx)(n.h3,{id:"\u7f16\u8bd1\u65f6\u4f18\u5316",children:"\u7f16\u8bd1\u65f6\u4f18\u5316"}),"\n",(0,i.jsx)(n.h4,{id:"es6\u7279\u6027\u7684\u4f18\u5316",children:"ES6\u7279\u6027\u7684\u4f18\u5316"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u7bad\u5934\u51fd\u6570\u4f18\u5316\nbool BytecodeGenerator::ShouldOptimizeArrowFunction(FunctionLiteral* literal) {\n  // \u7bad\u5934\u51fd\u6570\u53ef\u4ee5\u8fdb\u884c\u66f4\u6fc0\u8fdb\u7684\u4f18\u5316\n  return IsArrowFunction(literal->kind()) && \n         !literal->has_complex_parameter_list();\n}\n\n// \u7c7b\u65b9\u6cd5\u4f18\u5316\nvoid BytecodeGenerator::DefineClassMethod(ClassLiteralProperty* property) {\n  // \u7c7b\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u7ed1\u5b9a\u5230\u539f\u578b\n  if (property->is_static()) {\n    // \u9759\u6001\u65b9\u6cd5\u7ed1\u5b9a\u5230\u6784\u9020\u51fd\u6570\n  } else {\n    // \u5b9e\u4f8b\u65b9\u6cd5\u7ed1\u5b9a\u5230\u539f\u578b\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u8fd0\u884c\u65f6\u6027\u80fd",children:"\u8fd0\u884c\u65f6\u6027\u80fd"}),"\n",(0,i.jsx)(n.h4,{id:"letconst\u7684\u6027\u80fd\u5f00\u9500",children:"let/const\u7684\u6027\u80fd\u5f00\u9500"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// TDZ\u68c0\u67e5\u7684\u6027\u80fd\u6210\u672c\nvoid BytecodeGenerator::BuildVariableLoad(Variable* variable) {\n  if (variable->IsLexical() && variable->binding_needs_init()) {\n    // \u6bcf\u6b21\u8bbf\u95ee\u90fd\u9700\u8981\u68c0\u67e5TDZ\n    builder()->ThrowReferenceErrorIfHole(variable->raw_name());\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u5757\u7ea7\u4f5c\u7528\u57df\u7684\u5185\u5b58\u5f00\u9500",children:"\u5757\u7ea7\u4f5c\u7528\u57df\u7684\u5185\u5b58\u5f00\u9500"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u6bcf\u4e2a\u5757\u90fd\u9700\u8981\u521b\u5efa\u65b0\u7684\u4f5c\u7528\u57df\u5bf9\u8c61\nclass BlockScope : public Scope {\n  // \u989d\u5916\u7684\u5185\u5b58\u5f00\u9500\u7528\u4e8e\u5b58\u50a8\u5757\u7ea7\u53d8\u91cf\n  VariableMap block_variables_;\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"9-\u8c03\u8bd5\u548c\u5de5\u5177\u652f\u6301",children:"9. \u8c03\u8bd5\u548c\u5de5\u5177\u652f\u6301"}),"\n",(0,i.jsx)(n.h3,{id:"\u6e90\u7801\u6620\u5c04",children:"\u6e90\u7801\u6620\u5c04"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// ES6\u4ee3\u7801\u9700\u8981\u66f4\u590d\u6742\u7684\u6e90\u7801\u6620\u5c04\nclass SourcePositionTableBuilder {\n  // \u8bb0\u5f55\u8f6c\u6362\u540e\u4ee3\u7801\u4e0e\u539f\u59cb\u4ee3\u7801\u7684\u4f4d\u7f6e\u6620\u5c04\n  void AddPosition(int code_offset, SourcePosition source_position);\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u8c03\u8bd5\u4fe1\u606f",children:"\u8c03\u8bd5\u4fe1\u606f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770bES6\u7279\u6027\u7684\u5b57\u8282\u7801\nd8 --print-bytecode --harmony-classes es6-class.js\n\n# \u67e5\u770b\u6a21\u5757\u52a0\u8f7d\u8fc7\u7a0b\nd8 --trace-module-status module.mjs\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsx)(n.p,{children:"ES6\u5728V8\u4e2d\u7684\u5b9e\u73b0\u6d89\u53ca\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u8bed\u6cd5\u5c42\u9762"}),": \u65b0\u7684AST\u8282\u70b9\u7c7b\u578b\u548c\u89e3\u6790\u903b\u8f91"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u8bed\u4e49\u5c42\u9762"}),": \u65b0\u7684\u4f5c\u7528\u57df\u89c4\u5219\u548c\u53d8\u91cf\u7ed1\u5b9a\u673a\u5236"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u8fd0\u884c\u65f6\u5c42\u9762"}),": \u65b0\u7684\u5185\u7f6e\u5bf9\u8c61\u548c\u8fd0\u884c\u65f6\u68c0\u67e5"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4f18\u5316\u5c42\u9762"}),": \u9488\u5bf9\u65b0\u7279\u6027\u7684\u7f16\u8bd1\u5668\u4f18\u5316"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e9b\u53d8\u5316\u4f7f\u5f97ES6\u4ee3\u7801\u5728\u529f\u80fd\u66f4\u5f3a\u5927\u7684\u540c\u65f6\uff0c\u4e5f\u5e26\u6765\u4e86\u4e00\u5b9a\u7684\u6027\u80fd\u5f00\u9500\uff0c\u4f46V8\u901a\u8fc7\u6301\u7eed\u7684\u4f18\u5316\u6765\u6700\u5c0f\u5316\u8fd9\u4e9b\u5f00\u9500\u3002"})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>t});var s=r(6540);const i={},a=s.createContext(i);function l(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);