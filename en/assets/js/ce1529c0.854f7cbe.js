"use strict";(self.webpackChunkrobin_note_book=self.webpackChunkrobin_note_book||[]).push([[4855],{4883:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"L-\u6e90\u7801\u7cfb\u5217/variable-hoisting","title":"\u53d8\u91cf\u63d0\u5347\u673a\u5236\u6df1\u5ea6\u5206\u6790","description":"\u6982\u8ff0","source":"@site/docs/L-\u6e90\u7801\u7cfb\u5217/10-variable-hoisting.md","sourceDirName":"L-\u6e90\u7801\u7cfb\u5217","slug":"/L-\u6e90\u7801\u7cfb\u5217/variable-hoisting","permalink":"/docs/en/main/L-\u6e90\u7801\u7cfb\u5217/variable-hoisting","draft":false,"unlisted":false,"editUrl":"https://github.com/EagerGrb/docs/L-\u6e90\u7801\u7cfb\u5217/10-variable-hoisting.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u5b66\u4e60\u8def\u5f84","permalink":"/docs/en/main/L-\u6e90\u7801\u7cfb\u5217/learning-path"},"next":{"title":"ES5\u4e0eES6\u5728JavaScript\u8fd0\u884c\u65f6\u7684\u5dee\u5f02\u5206\u6790","permalink":"/docs/en/main/L-\u6e90\u7801\u7cfb\u5217/es5-vs-es6-runtime"}}');var i=r(4848),a=r(8453);const o={},s="\u53d8\u91cf\u63d0\u5347\u673a\u5236\u6df1\u5ea6\u5206\u6790",c={},d=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u5b9e\u73b0\u539f\u7406",id:"\u5b9e\u73b0\u539f\u7406",level:2},{value:"1. \u89e3\u6790\u9636\u6bb5\u7684\u4f5c\u7528\u57df\u6784\u5efa",id:"1-\u89e3\u6790\u9636\u6bb5\u7684\u4f5c\u7528\u57df\u6784\u5efa",level:3},{value:"\u4f5c\u7528\u57df\u7c7b\u578b",id:"\u4f5c\u7528\u57df\u7c7b\u578b",level:4},{value:"\u53d8\u91cf\u58f0\u660e\u5904\u7406",id:"\u53d8\u91cf\u58f0\u660e\u5904\u7406",level:4},{value:"2. var\u58f0\u660e\u63d0\u5347",id:"2-var\u58f0\u660e\u63d0\u5347",level:3},{value:"\u89e3\u6790\u8fc7\u7a0b",id:"\u89e3\u6790\u8fc7\u7a0b",level:4},{value:"V8\u5185\u90e8\u5904\u7406",id:"v8\u5185\u90e8\u5904\u7406",level:4},{value:"3. \u51fd\u6570\u58f0\u660e\u63d0\u5347",id:"3-\u51fd\u6570\u58f0\u660e\u63d0\u5347",level:3},{value:"\u5b8c\u6574\u63d0\u5347\u673a\u5236",id:"\u5b8c\u6574\u63d0\u5347\u673a\u5236",level:4},{value:"V8\u5904\u7406\u6d41\u7a0b",id:"v8\u5904\u7406\u6d41\u7a0b",level:4},{value:"4. let/const\u7684\u6682\u65f6\u6027\u6b7b\u533a",id:"4-letconst\u7684\u6682\u65f6\u6027\u6b7b\u533a",level:3},{value:"TDZ\u5b9e\u73b0",id:"tdz\u5b9e\u73b0",level:4},{value:"\u8fd0\u884c\u65f6\u68c0\u67e5",id:"\u8fd0\u884c\u65f6\u68c0\u67e5",level:4},{value:"\u5b57\u8282\u7801\u5c42\u9762\u7684\u5b9e\u73b0",id:"\u5b57\u8282\u7801\u5c42\u9762\u7684\u5b9e\u73b0",level:2},{value:"var\u63d0\u5347\u7684\u5b57\u8282\u7801",id:"var\u63d0\u5347\u7684\u5b57\u8282\u7801",level:3},{value:"\u51fd\u6570\u63d0\u5347\u7684\u5b57\u8282\u7801",id:"\u51fd\u6570\u63d0\u5347\u7684\u5b57\u8282\u7801",level:3},{value:"\u4f5c\u7528\u57df\u94fe\u548c\u53d8\u91cf\u67e5\u627e",id:"\u4f5c\u7528\u57df\u94fe\u548c\u53d8\u91cf\u67e5\u627e",level:2},{value:"\u4f5c\u7528\u57df\u94fe\u6784\u5efa",id:"\u4f5c\u7528\u57df\u94fe\u6784\u5efa",level:3},{value:"\u53d8\u91cf\u89e3\u6790\u8fc7\u7a0b",id:"\u53d8\u91cf\u89e3\u6790\u8fc7\u7a0b",level:3},{value:"ES6\u5757\u7ea7\u4f5c\u7528\u57df\u7684\u5904\u7406",id:"es6\u5757\u7ea7\u4f5c\u7528\u57df\u7684\u5904\u7406",level:2},{value:"\u5757\u7ea7\u4f5c\u7528\u57df\u521b\u5efa",id:"\u5757\u7ea7\u4f5c\u7528\u57df\u521b\u5efa",level:3},{value:"let/const\u7684\u4f5c\u7528\u57df\u7ed1\u5b9a",id:"letconst\u7684\u4f5c\u7528\u57df\u7ed1\u5b9a",level:3},{value:"\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",id:"\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",level:2},{value:"\u590d\u6742\u63d0\u5347\u573a\u666f",id:"\u590d\u6742\u63d0\u5347\u573a\u666f",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:3},{value:"\u9884\u89e3\u6790\u4f18\u5316",id:"\u9884\u89e3\u6790\u4f18\u5316",level:4},{value:"\u4f5c\u7528\u57df\u7f13\u5b58",id:"\u4f5c\u7528\u57df\u7f13\u5b58",level:4},{value:"\u8c03\u8bd5\u548c\u5206\u6790",id:"\u8c03\u8bd5\u548c\u5206\u6790",level:2},{value:"\u67e5\u770b\u63d0\u5347\u6548\u679c",id:"\u67e5\u770b\u63d0\u5347\u6548\u679c",level:3},{value:"\u5e38\u89c1\u9677\u9631",id:"\u5e38\u89c1\u9677\u9631",level:3}];function t(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u53d8\u91cf\u63d0\u5347\u673a\u5236\u6df1\u5ea6\u5206\u6790",children:"\u53d8\u91cf\u63d0\u5347\u673a\u5236\u6df1\u5ea6\u5206\u6790"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsx)(n.p,{children:"\u53d8\u91cf\u63d0\u5347\uff08Hoisting\uff09\u662fJavaScript\u7684\u4e00\u4e2a\u91cd\u8981\u7279\u6027\uff0c\u5728V8\u5f15\u64ce\u4e2d\u901a\u8fc7\u89e3\u6790\u9636\u6bb5\u7684\u4f5c\u7528\u57df\u5206\u6790\u548c\u53d8\u91cf\u9884\u58f0\u660e\u6765\u5b9e\u73b0\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5b9e\u73b0\u539f\u7406",children:"\u5b9e\u73b0\u539f\u7406"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u89e3\u6790\u9636\u6bb5\u7684\u4f5c\u7528\u57df\u6784\u5efa",children:"1. \u89e3\u6790\u9636\u6bb5\u7684\u4f5c\u7528\u57df\u6784\u5efa"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u4f4d\u7f6e"}),": ",(0,i.jsx)(n.code,{children:"src/parsing/parser.cc"})," \u548c ",(0,i.jsx)(n.code,{children:"src/ast/scopes.h"})]}),"\n",(0,i.jsx)(n.h4,{id:"\u4f5c\u7528\u57df\u7c7b\u578b",children:"\u4f5c\u7528\u57df\u7c7b\u578b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"enum ScopeType {\n  SCRIPT_SCOPE,      // \u811a\u672c\u4f5c\u7528\u57df\n  FUNCTION_SCOPE,    // \u51fd\u6570\u4f5c\u7528\u57df\n  MODULE_SCOPE,      // \u6a21\u5757\u4f5c\u7528\u57df\n  EVAL_SCOPE,        // eval\u4f5c\u7528\u57df\n  BLOCK_SCOPE,       // \u5757\u7ea7\u4f5c\u7528\u57df\n  CATCH_SCOPE,       // catch\u4f5c\u7528\u57df\n  WITH_SCOPE         // with\u4f5c\u7528\u57df\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u53d8\u91cf\u58f0\u660e\u5904\u7406",children:"\u53d8\u91cf\u58f0\u660e\u5904\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class DeclarationScope : public Scope {\n  // \u5904\u7406var\u58f0\u660e\u7684\u63d0\u5347\n  void DeclareVariable(Declaration* declaration, \n                      const AstRawString* name,\n                      VariableMode mode, \n                      VariableKind kind);\n                      \n  // \u5904\u7406\u51fd\u6570\u58f0\u660e\u7684\u63d0\u5347\n  Variable* DeclareFunctionVar(const AstRawString* name);\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-var\u58f0\u660e\u63d0\u5347",children:"2. var\u58f0\u660e\u63d0\u5347"}),"\n",(0,i.jsx)(n.h4,{id:"\u89e3\u6790\u8fc7\u7a0b",children:"\u89e3\u6790\u8fc7\u7a0b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u6e90\u7801\nfunction example() {\n  console.log(x); // undefined (\u4e0d\u662fReferenceError)\n  var x = 5;\n  console.log(x); // 5\n}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"v8\u5185\u90e8\u5904\u7406",children:"V8\u5185\u90e8\u5904\u7406"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u9884\u626b\u63cf\u9636\u6bb5"}),": \u626b\u63cf\u6240\u6709var\u58f0\u660e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4f5c\u7528\u57df\u521b\u5efa"}),": \u5728\u51fd\u6570\u4f5c\u7528\u57df\u9876\u90e8\u521b\u5efa\u53d8\u91cf"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u521d\u59cb\u5316\u5206\u79bb"}),": \u58f0\u660e\u63d0\u5347\uff0c\u8d4b\u503c\u7559\u5728\u539f\u4f4d\u7f6e"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u5728Parser::ParseVariableStatement\u4e2d\nvoid Parser::ParseVariableStatement(StatementListItem, \n                                   ZonePtrList<const AstRawString>* names) {\n  // var\u58f0\u660e\u4f1a\u88ab\u63d0\u5347\u5230\u51fd\u6570\u4f5c\u7528\u57df\u9876\u90e8\n  Variable* var = DeclareVariable(name, VariableMode::kVar, \n                                 NORMAL_VARIABLE, kCreatedInitialized);\n  // \u5b9e\u9645\u7684\u8d4b\u503c\u64cd\u4f5c\u4fdd\u7559\u5728\u539f\u4f4d\u7f6e\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u51fd\u6570\u58f0\u660e\u63d0\u5347",children:"3. \u51fd\u6570\u58f0\u660e\u63d0\u5347"}),"\n",(0,i.jsx)(n.h4,{id:"\u5b8c\u6574\u63d0\u5347\u673a\u5236",children:"\u5b8c\u6574\u63d0\u5347\u673a\u5236"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// \u6e90\u7801\nconsole.log(foo()); // "Hello" - \u51fd\u6570\u53ef\u4ee5\u5728\u58f0\u660e\u524d\u8c03\u7528\n\nfunction foo() {\n  return "Hello";\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"v8\u5904\u7406\u6d41\u7a0b",children:"V8\u5904\u7406\u6d41\u7a0b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u5728Parser::ParseFunctionDeclaration\u4e2d\nStatement* Parser::DeclareFunction(const AstRawString* variable_name,\n                                  FunctionLiteral* function, \n                                  VariableMode mode) {\n  // \u51fd\u6570\u58f0\u660e\u5b8c\u5168\u63d0\u5347\uff0c\u5305\u62ec\u51fd\u6570\u4f53\n  Declaration* declaration = factory()->NewFunctionDeclaration(function, pos);\n  // \u5728\u4f5c\u7528\u57df\u9876\u90e8\u521b\u5efa\u51fd\u6570\u53d8\u91cf\n  Declare(declaration, variable_name, NORMAL_VARIABLE, mode, \n          kCreatedInitialized, scope());\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-letconst\u7684\u6682\u65f6\u6027\u6b7b\u533a",children:"4. let/const\u7684\u6682\u65f6\u6027\u6b7b\u533a"}),"\n",(0,i.jsx)(n.h4,{id:"tdz\u5b9e\u73b0",children:"TDZ\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class Variable {\n  // \u53d8\u91cf\u7684\u521d\u59cb\u5316\u72b6\u6001\n  enum InitializationFlag {\n    kNeedsInitialization,    // let/const\u9700\u8981\u521d\u59cb\u5316\n    kCreatedInitialized      // var\u5df2\u521d\u59cb\u5316\n  };\n  \n  // \u521d\u59cb\u5316\u4f4d\u7f6e\u8bb0\u5f55\n  int initializer_position() const { return initializer_position_; }\n  void set_initializer_position(int pos) { initializer_position_ = pos; }\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u8fd0\u884c\u65f6\u68c0\u67e5",children:"\u8fd0\u884c\u65f6\u68c0\u67e5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u5728\u5b57\u8282\u7801\u751f\u6210\u65f6\u63d2\u5165TDZ\u68c0\u67e5\nvoid BytecodeGenerator::VisitVariableProxy(VariableProxy* proxy) {\n  Variable* variable = proxy->var();\n  if (variable->mode() == VariableMode::kLet || \n      variable->mode() == VariableMode::kConst) {\n    // \u751f\u6210TDZ\u68c0\u67e5\u5b57\u8282\u7801\n    builder()->LoadLiteral(variable);\n    builder()->ThrowReferenceErrorIfHole(variable->raw_name());\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b57\u8282\u7801\u5c42\u9762\u7684\u5b9e\u73b0",children:"\u5b57\u8282\u7801\u5c42\u9762\u7684\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.h3,{id:"var\u63d0\u5347\u7684\u5b57\u8282\u7801",children:"var\u63d0\u5347\u7684\u5b57\u8282\u7801"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"function test() {\n  console.log(x); // undefined\n  var x = 5;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u751f\u6210\u7684\u5b57\u8282\u7801\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"// \u51fd\u6570\u5f00\u59cb\u65f6x\u5df2\u7ecf\u88ab\u58f0\u660e\u4e3aundefined\nLdaUndefined          // \u52a0\u8f7dundefined\nStar r0               // \u5b58\u50a8\u5230\u5bc4\u5b58\u5668r0 (\u53d8\u91cfx)\n\n// console.log(x)\nLdaGlobal [0]         // \u52a0\u8f7dconsole\nStar r1\nLdaNamedProperty r1, [1] // \u52a0\u8f7dlog\u65b9\u6cd5\nStar r2\nLdar r0               // \u52a0\u8f7dx\u7684\u503c(undefined)\nCallProperty r2, r1, [2] // \u8c03\u7528console.log\n\n// x = 5\nLdaSmi [5]            // \u52a0\u8f7d\u5e38\u91cf5\nStar r0               // \u5b58\u50a8\u5230x\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u51fd\u6570\u63d0\u5347\u7684\u5b57\u8282\u7801",children:"\u51fd\u6570\u63d0\u5347\u7684\u5b57\u8282\u7801"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"console.log(foo()); // \u53ef\u4ee5\u8c03\u7528\nfunction foo() { return 42; }\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u751f\u6210\u7684\u5b57\u8282\u7801\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"// \u51fd\u6570\u58f0\u660e\u5728\u4f5c\u7528\u57df\u5f00\u59cb\u65f6\u5c31\u5b8c\u6210\nCreateClosure [0], [1] // \u521b\u5efa\u51fd\u6570\u95ed\u5305\nStar r0                // \u5b58\u50a8\u51fd\u6570\u5230\u53d8\u91cffoo\n\n// console.log(foo())\nLdaGlobal [2]          // \u52a0\u8f7dconsole\nStar r1\nLdaNamedProperty r1, [3] // \u52a0\u8f7dlog\u65b9\u6cd5\nStar r2\nLdar r0                // \u52a0\u8f7d\u51fd\u6570foo\nCallUndefinedReceiver r0, [4] // \u8c03\u7528foo()\nCallProperty r2, r1, [5] // \u8c03\u7528console.log\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4f5c\u7528\u57df\u94fe\u548c\u53d8\u91cf\u67e5\u627e",children:"\u4f5c\u7528\u57df\u94fe\u548c\u53d8\u91cf\u67e5\u627e"}),"\n",(0,i.jsx)(n.h3,{id:"\u4f5c\u7528\u57df\u94fe\u6784\u5efa",children:"\u4f5c\u7528\u57df\u94fe\u6784\u5efa"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class Scope {\n  Scope* outer_scope_;  // \u5916\u5c42\u4f5c\u7528\u57df\n  VariableMap variables_; // \u5f53\u524d\u4f5c\u7528\u57df\u7684\u53d8\u91cf\n  \n  // \u53d8\u91cf\u67e5\u627e\n  Variable* Lookup(VariableProxy* proxy, Scope* scope, Scope* outer_scope_end);\n};\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u53d8\u91cf\u89e3\u6790\u8fc7\u7a0b",children:"\u53d8\u91cf\u89e3\u6790\u8fc7\u7a0b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"void Parser::ResolveVariable(VariableProxy* proxy) {\n  // \u4ece\u5f53\u524d\u4f5c\u7528\u57df\u5f00\u59cb\u5411\u4e0a\u67e5\u627e\n  Variable* var = scope()->LookupLocal(proxy->raw_name());\n  if (var == nullptr) {\n    // \u5728\u5916\u5c42\u4f5c\u7528\u57df\u4e2d\u67e5\u627e\n    var = scope()->outer_scope()->LookupLocal(proxy->raw_name());\n  }\n  // \u7ed1\u5b9a\u53d8\u91cf\u4ee3\u7406\u5230\u5b9e\u9645\u53d8\u91cf\n  proxy->BindTo(var);\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"es6\u5757\u7ea7\u4f5c\u7528\u57df\u7684\u5904\u7406",children:"ES6\u5757\u7ea7\u4f5c\u7528\u57df\u7684\u5904\u7406"}),"\n",(0,i.jsx)(n.h3,{id:"\u5757\u7ea7\u4f5c\u7528\u57df\u521b\u5efa",children:"\u5757\u7ea7\u4f5c\u7528\u57df\u521b\u5efa"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u89e3\u6790\u5757\u8bed\u53e5\u65f6\u521b\u5efa\u65b0\u4f5c\u7528\u57df\nStatement* Parser::ParseBlock() {\n  BlockState block_state(&scope_, NewScope(BLOCK_SCOPE));\n  // \u5728\u5757\u4f5c\u7528\u57df\u4e2d\u89e3\u6790let/const\u58f0\u660e\n  ParseStatementList(&statements, Token::kRightBrace);\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"letconst\u7684\u4f5c\u7528\u57df\u7ed1\u5b9a",children:"let/const\u7684\u4f5c\u7528\u57df\u7ed1\u5b9a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"{\n  console.log(x); // ReferenceError: Cannot access 'x' before initialization\n  let x = 5;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"V8\u5904\u7406\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// let/const\u53d8\u91cf\u4e0d\u4f1a\u63d0\u5347\u5230\u51fd\u6570\u4f5c\u7528\u57df\nVariable* var = DeclareVariable(name, VariableMode::kLet, \n                               NORMAL_VARIABLE, kNeedsInitialization);\n// \u8bbe\u7f6e\u521d\u59cb\u5316\u4f4d\u7f6e\u7528\u4e8eTDZ\u68c0\u67e5\nvar->set_initializer_position(scanner()->location().beg_pos);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",children:"\u5b9e\u9645\u5e94\u7528\u793a\u4f8b"}),"\n",(0,i.jsx)(n.h3,{id:"\u590d\u6742\u63d0\u5347\u573a\u666f",children:"\u590d\u6742\u63d0\u5347\u573a\u666f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'function complex() {\n  console.log(typeof foo); // "function"\n  console.log(typeof bar); // "undefined"\n  \n  var bar = function() { return "bar"; };\n  \n  function foo() { return "foo"; }\n  \n  console.log(typeof bar); // "function"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"V8\u7684\u5904\u7406\u987a\u5e8f\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u51fd\u6570\u58f0\u660e\u63d0\u5347"}),": ",(0,i.jsx)(n.code,{children:"foo"}),"\u51fd\u6570\u5b8c\u6574\u63d0\u5347"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"var\u58f0\u660e\u63d0\u5347"}),": ",(0,i.jsx)(n.code,{children:"bar"}),"\u53d8\u91cf\u58f0\u660e\u63d0\u5347\uff0c\u521d\u59cb\u5316\u4e3a",(0,i.jsx)(n.code,{children:"undefined"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6267\u884c\u9636\u6bb5"}),": \u6309\u4ee3\u7801\u987a\u5e8f\u6267\u884c\u8d4b\u503c\u64cd\u4f5c"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,i.jsx)(n.h4,{id:"\u9884\u89e3\u6790\u4f18\u5316",children:"\u9884\u89e3\u6790\u4f18\u5316"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"class PreParser {\n  // \u9884\u89e3\u6790\u65f6\u6536\u96c6\u53d8\u91cf\u4fe1\u606f\uff0c\u907f\u514d\u91cd\u590d\u89e3\u6790\n  void PreParseFunction(const AstRawString* function_name,\n                       FunctionKind kind,\n                       DeclarationScope* function_scope);\n};\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u4f5c\u7528\u57df\u7f13\u5b58",children:"\u4f5c\u7528\u57df\u7f13\u5b58"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// \u7f13\u5b58\u4f5c\u7528\u57df\u4fe1\u606f\u4ee5\u63d0\u9ad8\u6027\u80fd\nclass ScopeInfo : public FixedArray {\n  // \u5b58\u50a8\u53d8\u91cf\u540d\u3001\u7c7b\u578b\u3001\u4f4d\u7f6e\u7b49\u4fe1\u606f\n  static Handle<ScopeInfo> Create(Isolate* isolate, Zone* zone, Scope* scope);\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u8c03\u8bd5\u548c\u5206\u6790",children:"\u8c03\u8bd5\u548c\u5206\u6790"}),"\n",(0,i.jsx)(n.h3,{id:"\u67e5\u770b\u63d0\u5347\u6548\u679c",children:"\u67e5\u770b\u63d0\u5347\u6548\u679c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u4f7f\u7528d8\u67e5\u770b\u5b57\u8282\u7801\nd8 --print-bytecode script.js\n\n# \u67e5\u770b\u4f5c\u7528\u57df\u4fe1\u606f\nd8 --trace-scope-resolution script.js\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5e38\u89c1\u9677\u9631",children:"\u5e38\u89c1\u9677\u9631"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"\u5faa\u73af\u4e2d\u7684var\u58f0\u660e"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"for (var i = 0; i < 3; i++) {\n  setTimeout(() => console.log(i), 100); // \u8f93\u51fa3\u6b213\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"\u51fd\u6570\u8868\u8fbe\u5f0fvs\u51fd\u6570\u58f0\u660e"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"console.log(foo); // undefined\nconsole.log(bar); // ReferenceError\n\nvar foo = function() {};\nlet bar = function() {};\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53d8\u91cf\u63d0\u5347\u662fJavaScript\u8bed\u8a00\u8bbe\u8ba1\u7684\u6838\u5fc3\u7279\u6027\uff0cV8\u901a\u8fc7\u7cbe\u5bc6\u7684\u89e3\u6790\u548c\u4f5c\u7528\u57df\u7ba1\u7406\u673a\u5236\u6765\u5b9e\u73b0\u8fd9\u4e00\u7279\u6027\uff0c\u786e\u4fdd\u4ee3\u7801\u7684\u6b63\u786e\u6267\u884c\u548c\u6027\u80fd\u4f18\u5316\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>s});var l=r(6540);const i={},a=l.createContext(i);function o(e){const n=l.useContext(a);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),l.createElement(a.Provider,{value:n},e.children)}}}]);